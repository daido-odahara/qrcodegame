!doctype html
html lang=ja
head
  meta charset=utf-8 
  meta name=viewport content=width=device-width,initial-scale=1,viewport-fit=cover 
  titleCamera Testtitle
  style
    body{font-familysystem-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin16px; line-height1.4}
    button{font-size18px; padding12px 16px; border-radius12px; border1px solid #ccc; background#111; color#fff}
    pre{white-spacepre-wrap; background#f6f6f6; padding12px; border-radius12px}
    video{width100%; max-width520px; background#000; border-radius12px}
    .ok{color#0a7} .ng{color#c22}
  style
head
body
  h1Camera Testh1
  p目的：bカメラが起動できるかbだけ確認します。p

  p
    button id=btnTap to start camerabutton
  p

  video id=v playsinline autoplay mutedvideo

  h3Logh3
  pre id=logpre

script
  const logEl = document.getElementById(log);
  const video = document.getElementById(v);
  const btn = document.getElementById(btn);
  let stream = null;

  function log(msg, isOk){
    const tag = isOk === true  ✅   (isOk === false  ❌   • );
    logEl.textContent += tag + msg + n;
  }

  async function startCamera() {
     すでに起動してたら停止→再起動
    if (stream) {
      stream.getTracks().forEach(t = t.stop());
      stream = null;
      log(Stopped previous stream);
    }

     まずは“ゆるい”指定で確実性を優先（失敗したら原因が見える）
    const constraints = { video true, audio false };

    try {
      log(Requesting camera...);
      stream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = stream;
      log(Camera started!, true);

      const track = stream.getVideoTracks()[0];
      log(Track  + (track.label  (no label)));
      log(Settings  + JSON.stringify(track.getSettings  track.getSettings()  {}, null, 2));
    } catch (err) {
      log(getUserMedia failed, false);
      log(name  + (err.name  err), false);
      log(message  + (err.message  ), false);

       よくあるケースのヒント
      const name = err.name  ;
      if (name === NotAllowedError) {
        log(ヒント カメラ許可がOFF  もしくはアプリ内ブラウザ(WebView)の可能性, false);
      } else if (name === NotFoundError) {
        log(ヒント カメラが見つからない（端末権限企業ポリシー等）, false);
      } else if (name === NotReadableError) {
        log(ヒント 他アプリがカメラ使用中  OSが一時的に占有, false);
      } else if (name === SecurityError) {
        log(ヒント HTTPSではない、またはブラウザが制限している, false);
      }
    }
  }

   自動起動も一応“試す”（多くの環境で失敗するので、ログ確認用）
  window.addEventListener(load, () = {
    log(UA  + navigator.userAgent);
    log(Try auto start on load...);
    startCamera();
  });

  btn.addEventListener(click, startCamera);
script
body
html
