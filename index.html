<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Camera Test</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:16px; line-height:1.4}
    button{font-size:18px; padding:12px 16px; border-radius:12px; border:1px solid #ccc; background:#111; color:#fff}
    pre{white-space:pre-wrap; background:#f6f6f6; padding:12px; border-radius:12px}
    video{width:100%; max-width:520px; background:#000; border-radius:12px}
  </style>
</head>
<body>
  <h1>Camera Test</h1>
  <p>目的：<b>カメラが起動できるか</b>だけ確認します。</p>

  <p><button id="btn">Tap to start camera</button></p>

  <video id="v" playsinline autoplay muted></video>

  <h3>Log</h3>
  <pre id="log"></pre>

  <script>
    const logEl = document.getElementById("log");
    const video = document.getElementById("v");
    const btn   = document.getElementById("btn");
    let stream = null;

    function addLog(msg){
      logEl.textContent += msg + "\n";
    }

    async function startCamera() {
      try {
        addLog("Requesting camera...");
        // まずは“ゆるい”指定（確実性優先）
        stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        video.srcObject = stream;
        addLog("Camera started! ✅");

        const track = stream.getVideoTracks()[0];
        addLog("Track: " + (track?.label || "(no label)"));
        if (track?.getSettings) addLog("Settings: " + JSON.stringify(track.getSettings(), null, 2));
      } catch (err) {
        addLog("getUserMedia failed ❌");
        addLog("name: " + (err?.name || err));
        addLog("message: " + (err?.message || ""));
      }
    }

    // 自動起動も一応試す（失敗してもログに出るだけ）
    window.addEventListener("load", () => {
      addLog("UA: " + navigator.userAgent);
      addLog("Try auto start on load...");
      startCamera();
    });

    btn.addEventListener("click", startCamera);
  </script>
</body>
</html>
